name: CD - Main Branch (Production)

on:
  push:
    branches:
      - main

jobs:
  validate:
    name: Validate Production Ready
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create .env files
        run: |
          cp gateway/.env.example gateway/.env || echo "PORT=8000" > gateway/.env
          cp services/auth-service/.env.example services/auth-service/.env || true
          cp services/quiz-service/.env.example services/quiz-service/.env || true
          cp services/result-service/.env.example services/result-service/.env || true

      - name: Validate docker-compose
        run: docker compose config --quiet

      - name: Check required files
        run: |
          test -f docker-compose.yml || exit 1
          test -f scripts/init-db.sql || exit 1
          test -f services/auth-service/Dockerfile || exit 1
          test -f services/quiz-service/Dockerfile || exit 1
          test -f services/result-service/Dockerfile || exit 1
          test -f gateway/Dockerfile || exit 1
          test -f frontend/Dockerfile || exit 1
          echo "âœ… All required files present"

  # TODO: Add deployment steps here
  # deploy:
  #   name: Deploy to Production
  #   runs-on: ubuntu-latest
  #   needs: validate
  #   steps:
  #     - name: Deploy to server
  #       run: echo "Deploy to production server"
